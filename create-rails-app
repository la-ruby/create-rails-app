#!/usr/bin/env bash
set -Eeuo pipefail

set -x

init_db() {
  [ -d ~/.cra ] || mkdir ~/.cra
  [ -d ~/.cra/bin ] || mkdir ~/.cra/bin
}

verify_ruby_version() {
  export RBENV_VERSION="$(latest_stable_ruby)"
  ruby_version=$(ruby -v)
  echo $ruby_version | grep "$(latest_stable_ruby)"
}

latest_stable_ruby() {
  curl -s https://cache.ruby-lang.org/pub/ruby/index.txt | tail -n 1 | cut -f1 | cut -d '-' -f2
}

# GLOBALS
export CRA_ROOT="${HOME}/.cra"
export CRA_RAILS_BRANCH="6-0-stable"

init_db
verify_ruby_version


#git clone -b $CRA_RAILS_BRANCH --single-branch https://github.com/rails/rails ${CRA_ROOT}/rails
#(cd $CRA_ROOT/rails/ && ruby --version)

# PATH="$PATH:/Users/administrator/create-rails-app" create-rails-app; echo $?